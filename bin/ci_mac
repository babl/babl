#!/bin/bash -xe

go version

go build -v ./...
go test -v ./...

# client
go install
babl --help
echo i should be upper case now | babl string-upcase
gox -osarch="linux/amd64" -osarch="darwin/amd64"
cat babl_linux_amd64 | gzip | babl s3:babl -e FILE=/babl_linux_amd64.gz
cat babl_darwin_amd64 | gzip | babl s3:babl -e FILE=/babl_darwin_amd64.gz

# server
cd babl-server
go install
babl-server --help
gox -osarch="linux/amd64"
cat babl-server_linux_amd64 | gzip | babl s3:babl -e FILE=/babl-server_linux_amd64.gz


cd ..
rm -f babl_darwin_amd64 babl_linux_amd64 babl-server/babl-server_linux_amd64
