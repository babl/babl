#!/usr/bin/env ruby

require 'pathname'


protobuf_path = File.expand_path('../../protobuf', __FILE__)

Dir["#{protobuf_path}/**/*.proto"].each do |proto_path|
  system %{protoc -I $GOPATH/src "#{proto_path}" --go_out=plugins=grpc:protobuf}
end

Dir["#{protobuf_path}/github.com/**/*.pb.go"].each do |from|
  to = Pathname.new(from).relative_path_from(Pathname.new File.expand_path('github.com/larskluge/babl', protobuf_path))
  system 'mv', from, to.to_s
end

system "rm -rf protobuf/github.com"
